@using System.Data;
@using Autravel.Extentions;
@using Autravel.Models.Function;
@{
    ViewBag.Title = "Combo trọn gói";
    var ChuDe = (DataTable)ViewBag.ChuDe;
    var BanChay = (DataTable)ViewBag.BanChay;
    var DiaDiem = (DataTable)ViewBag.DiaDiem;
    var CamNang = (DataTable)ViewBag.CamNang;
    var BANNER = (DataTable)ViewBag.BANNER;
}

<div class="banner-site">
    <div class="slider-banner">
        <div id="SlideBannerCombo" class="carousel slide" data-ride="carousel">
           
            <div class="carousel-inner">
                @foreach (DataRow item in BANNER.Rows)
                {
                    <div class="item">
                        <img src="@item["UrlFile"]">
                    </div>
                }
            </div>

            <!-- Left and right controls -->
            <a class="left carousel-control" href="#SlideBannerCombo" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#SlideBannerCombo" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    <div class="content-banner">
        <div class="container">
            <div class="content">
                <h3 class="titel-banner">@Text.Show("Combo_Intro")</h3>
                <span class="sologan-banner">@Text.Show("Combo_Intro_sub")</span>
                <div class="searchbox-banner">
                    <form class="formsearch" action="/s/all" method="get" role="search">
                        <div class="div-location">
                            <label class="titel-lbl-location">Địa điểm </label>
                            <input class="inp-location" id="inp-location" placeholder="Bạn sắp đi đâu?" />
                        </div>
                        <div class="div-Departure">
                            <label class="lbl-Departure">
                                <div class="titel-lbl-Departure">Thời gian </div>
                                <input class="inp-Departure" id="inp-Departure" placeholder="Vui lòng chọn thời gian!" />
                            </label>
                        </div>
                        <div class="div-btnSearchbox">
                            <a  class="btn btn-primary" id="btnSearchbox">
                                <i class="fa  fa-search"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ComboForYou">
    <div class="container">
        <div class="headingContent">
            <h4 class="heading">Combo dành riêng cho bạn</h4>
            <span class="description-heading">Khám phá những Combo đặc biệt nhé</span>
        </div>
        <div class="body-content-Combo">
            @foreach (DataRow item in ChuDe.Rows)
            {
                <a href="/PCombo/ListCombo">
                    <div class="col-md-2 combo-item">
                        <div class="div-img-combo">
                            <img class="img-combo" src="@item["TopicTour_Image"]" />
                        </div>
                        <div class="titel-combo">
                            <b class="titel">@item["TopicTour_Name"]</b>
                        </div>
                    </div>

                </a>
            }

        </div>
    </div>
</div>
<div class="ComboBestSelling">
    <div class="container">
        <div class="headingContent">
            <h4 class="heading">Combo bán chạy nhất</h4>
            <span class="description-heading">Lên đường săn tuyến với combo Sapa của Autravel</span>
        </div>
        <div class="body-content-Combo">
            @foreach (DataRow item in BanChay.Rows)
            {
                <a href="/PCombo/Details/@item["Tour_ID"]">
                    <div class="col-md-3 combo-item">
                        <div class="div-img-combo">
                            <img class="img-combo" src="@item["Tour_Image"]" />
                            <span class="time-duration">@item["Tour_TimeZoneText"]</span>
                        </div>
                        <div class="titel-combo">
                            @*<span class="location-combo-item">SAPA</span>*@
                            @*<span class="titel"><a>Chụp ảnh</a></span>*@
                            <div class="rateStar-item">
                                @Html.Raw(Funtions.FillStarView(item.ToFloat("Tour_StarRate")))
                            </div>
                            <span class="extention-combo">Trọn gói: Khách sạn + xe khứ hồi</span>
                            <div class="price-item">@item.ToIntCurrency("Tour_Price") ₫</div>
                        </div>
                    </div>
                </a>
            }
        </div>
    </div>
</div>
<div class="PopularPlaces">
    <div class="container">
        <div class="headingContent">
            <h4 class="heading">Địa điểm phổ biến</h4>
            <span class="description-heading">Cùng Autravel khám phá những địa điểm đẹp nhé:</span>
        </div>
        <div class="body-content-Combo">
            @foreach (DataRow item in DiaDiem.Rows)
            {
                <a href="/PCombo/ListCombo">
                    <div class="col-md-3 combo-item">
                        <div class="div-img-combo">
                            <img class="img-combo" src="@item["Location_images"]" />
                        </div>
                        <div class="titel-combo">
                            <span class="titel"><a href="/">@item["Location_Name"]</a></span>
                            <span class="total-combo">2 combo</span>
                        </div>
                    </div>
                </a>
            }
        </div>
    </div>
</div>
<div class="Hanbook">
    <div class="container">
        <div class="headingContent">
            <h4 class="heading">Cẩm nang du lịch</h4>
            <span class="description-heading">Chuẩn bị hành trang cùng Autravel</span>
        </div>
        <div class="body-content-Combo">
            @foreach (DataRow item in CamNang.Rows)
            {
                <a href="/PCombo/Details">
                    <div class="col-md-3 combo-item">
                        <div class="div-img-combo">
                            <a href="/"> <img class="img-combo" src="@item["Post_Images"]" /></a>
                        </div>
                        <div class="titel-combo">
                            @*<span class="titel"><a href="/">Ẩm thực</a></span>*@
                            <b class="description-combo">@item["Post_Tile"]</b>
                        </div>
                    </div>
                </a>
            }
        </div>
    </div>
</div>
<script type="text/javascript">
    //Datepicker
    $(document).ready(function () {
        function getDaysOfMonth(year, month) {

            var monthStart = new Date(year, month, 1);
            var monthEnd = new Date(year, month + 1, 1);
            var monthLength = (monthEnd - monthStart) / (1000 * 60 * 60 * 24);
            return monthLength;

        }
        var d = new Date();
        var AutoDay = d.getDate() + 3;
        var AutoDayEnd = d.getDate() + 5;
        var TotalDayOfMonth = getDaysOfMonth(d.getFullYear(), d.getMonth());
        var AutoMonth = (d.getMonth() + 1);
        var AutoMonthEnd = (d.getMonth() + 1);
        var AutoYear = d.getFullYear();
        var AutoYearEnd = d.getFullYear();
        if (AutoDay > TotalDayOfMonth) {
            debugger;
            AutoDay = AutoDay - TotalDayOfMonth;
            AutoMonth += 1;
            if (AutoMonth > 12) {
                AutoYear += 1;
                AutoMonth = 1;
            }
        }
        if (AutoDayEnd > TotalDayOfMonth) {
            AutoDayEnd = AutoDayEnd - TotalDayOfMonth;
            AutoMonthEnd += 1;
            if (AutoMonthEnd > 12) {
                AutoYearEnd += 1;
                AutoMonthEnd = 1;
            }
        }
        output = [

            ('0' + AutoDay).substr(-2), ('0' + AutoMonth).substr(-2),
            AutoYear
        ].join('/');
        outputend = [

            ('0' + AutoDayEnd).substr(-2), ('0' + AutoMonthEnd).substr(-2),
            AutoYearEnd
        ].join('/');
        $('#inp-Departure').val(output + ' đến ' + outputend);
    });
    $('#inp-Departure').dateRangePicker({
        autoClose: true,
        format: 'DD/MM/YYYY',
        separator: ' đến ',
        language: 'vi',
        startOfWeek: 'monday',// or monday
        getValue: function () {
            return $(this).val();
        },
        setValue: function (s) {
            if (!$(this).attr('readonly') && !$(this).is(':disabled') && s != $(this).val()) {
                $(this).val(s);
            }
        },
        startDate: new Date(),
        endDate: false,
        time: {
            enabled: false
        },
        minDays: 0,
        maxDays: 0,
        showShortcuts: false,
        shortcuts:
        {
            //'prev-days': [1,3,5,7],
            //'next-days': [3,5,7],
            //'prev' : ['week','month','year'],
            //'next' : ['week','month','year']
        },
        customShortcuts: [],
        inline: false,
        container: 'body',
        alwaysOpen: false,
        singleDate: false,
        lookBehind: false,
        batchMode: false,
        duration: 200,
        stickyMonths: false,
        dayDivAttrs: [],
        dayTdAttrs: [],
        applyBtnClass: '',
        singleMonth: 'auto',
        hoveringTooltip: function (days, startTime, hoveringTime) {
            //return days > 1 ? days + ' ' + lang('days') : '';
        },
        showTopbar: true,
        swapTime: false,
        selectForward: false,
        selectBackward: false,
        showWeekNumbers: false,
        getWeekNumber: function (date) //date will be the first day of a week
        {
            return moment(date).format('w');
        },
        monthSelect: false,
        yearSelect: false
    });

 
     $.ajax({
        type: "POST",
        url: "/Pcombo/GetLocation",
         dataType: "json",
        success: function (response) {
            var response = JSON.parse(response);
            var objectKeys = $.map(response, function (value, key) {
                return value.Location_Name;
            });
            console.log(objectKeys);
            autocomplete(document.getElementById("inp-location"), objectKeys);
        }
    });
    $("#btnSearchbox").click(function (e) {
        e.preventDefault();
        var KeySearch = $("#inp-location").val();
        var ThoiGian = $("#inp-Departure").val();
         console.log(KeySearch);
        console.log(ThoiGian);
        KeySearch = encodeURI(KeySearch);
        ThoiGian = encodeURI(ThoiGian);
        window.location.href = "/PCombo/ListCombo?KeySearch=" + KeySearch + "&ThoiGian=" + ThoiGian;
    });
</script>
<script>
    $("#SlideBannerCombo .carousel-inner .item:eq(0)").addClass("active");
</script>